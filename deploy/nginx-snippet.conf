# File Uploader - Nginx configuration snippet
# Dodaj ten fragment do konfiguracji serwera HTTPS

# Główna lokalizacja
location / {
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # Timeout dla dużych plików
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    proxy_read_timeout 300s;
    
    # Buforowanie
    proxy_buffering on;
    proxy_buffer_size 4k;
    proxy_buffers 8 4k;
    proxy_busy_buffers_size 8k;
    
    # Maksymalny rozmiar pliku (dostosuj do MAX_CONTENT_LENGTH)
    client_max_body_size 512M;
    
    # Nagłówki bezpieczeństwa
    proxy_hide_header X-Powered-By;
    proxy_hide_header Server;
}

# Obsługa błędów
error_page 500 502 503 504 /50x.html;
location = /50x.html {
    root /usr/share/nginx/html;
}

# Logi
access_log /var/log/nginx/fileuploader_access.log;
error_log /var/log/nginx/fileuploader_error.log;

# Gzip compression
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_proxied any;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    application/atom+xml
    image/svg+xml;

# Cache dla plików statycznych
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Rate limiting (opcjonalne)
# limit_req_zone $binary_remote_addr zone=fileuploader:10m rate=10r/s;
# location / {
#     limit_req zone=fileuploader burst=20 nodelay;
#     # ... reszta konfiguracji
# }
